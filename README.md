# README - Setting Up Alert Management System

## Overview
This document provides step-by-step instructions to set up and run the Alert Management System, including three .NET services, Prometheus, and Alertmanager. It explains the flow of data, necessary configurations, and prerequisites required for the application to function correctly.

## Prerequisites
Ensure you have the following installed before proceeding:

- **.NET SDK 6 or later** - Required to run the .NET services
- **PostgreSQL** - Database for storing alert data
- **Prometheus** - Used for monitoring and scraping application metrics
- **Alertmanager** - Handles and manages alerts generated by Prometheus
- **Keycloak** - Authentication and authorization provider (if authentication is required)

## Services and Port Configuration

| Service      | Default Port |
|-------------|-------------|
| .NET API Service 1 | 5057 |
| Prometheus  | 9090 |
| Alertmanager | 9093 |

## Setting Up .NET Services
### Steps to Run .NET Services:
1. Navigate to each .NET service directory.
2. Restore dependencies:
   ```sh
   dotnet restore
   ```
3. Run the service:
   ```sh
   dotnet run
   ```
   The services should be running on ports **5057**.

## Setting Up Prometheus
Prometheus is used to scrape metrics from the .NET services.

### Steps to Run Prometheus:
1. Open the terminal and navigate to the Prometheus directory:
   ```sh
   cd D:\Users\bdileep\Source\Repos\Alert-Management2\Prometheus_Config\Prometheus
   ```
2. Start Prometheus using the configuration file:
   ```sh
   prometheus.exe --config.file=prometheus.yml
   ```
3. Access Prometheus UI in a browser:
   ```
   http://localhost:9090
   ```

## Setting Up Alertmanager
Alertmanager handles alerts sent from Prometheus and routes them to the correct recipients.

### Steps to Run Alertmanager:
1. Navigate to the Alertmanager directory:
   ```sh
   cd D:\Users\bdileep\Source\Repos\Alert-Management2\Prometheus_Config\Alertmanager
   ```
2. Start Alertmanager using the configuration file:
   ```sh
   alertmanager.exe --config.file=alertmanager.yml
   ```
3. Access Alertmanager UI in a browser:
   ```
   http://localhost:9093
   ```

## How the Flow Works
### 1. **Metrics Collection**
   - The .NET services expose metrics at:
     ```
     http://localhost:5057/metrics
     ```
   - Prometheus scrapes these metrics based on the `prometheus.yml` configuration.

### 2. **Alert Rules Evaluation**
   - Prometheus continuously evaluates alert rules defined in `prometheus.yml`.
   - If a rule condition is met (e.g., CPU usage exceeds 80%), Prometheus triggers an alert and sends it to Alertmanager.

### 3. **Alert Processing in Alertmanager**
   - Alertmanager processes the incoming alerts.
   - Based on the `alertmanager.yml` configuration, it routes the alerts to configured receivers (e.g., email, webhook).

### 4. **Alert Handling in the .NET API**
   - The .NET API receives alerts via a webhook endpoint (`/api/alerts/receive`).
   - Alerts are processed and stored in the PostgreSQL database.
   - WebSocket notifications are broadcasted to the UI for real-time alert updates.

## Prometheus Metrics Used
The following metrics are collected from the .NET services:

| Metric Name                  | Description                                  |
|------------------------------|---------------------------------------------
| `energy_consumed_kwh`        | Latest energy consumption per floor         |
| `peak_load_kw`               | Peak energy load per floor                  |
| `avg_temperature_c`          | Average temperature per floor               |
| `co2_emissions_kg`          | CO2 emissions measured per floor            |

## How Energy Metrics are Scraped
- The **EnergyMetricsService** in the .NET backend listens for changes in the `energy_consumption` table using **PostgreSQL LISTEN/NOTIFY**.
- When a change occurs, it fetches updated data from the database and updates Prometheus **Gauges** dynamically.
- Prometheus scrapes these updated metrics at regular intervals.

## Summary
1. Start the .NET services.
2. Run Prometheus and Alertmanager with the provided configuration files.
3. Verify that metrics are being scraped at `http://localhost:9090`.
4. Ensure that alerts are being processed by Alertmanager at `http://localhost:9093`.
5. Monitor real-time alerts and system health through the UI.

This setup ensures smooth alert generation, processing, and visualization for the Alert Management System.

